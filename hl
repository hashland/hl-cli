#!/bin/sh

API_URL=https://api.hashland.cc

if [ ! -f $HOME/.hashland ]; then
	echo Create a file in your home directory containing the api key with 
	echo echo API_KEY=xxxyourxxxapixxxkeyxxx \>\$HOME/.hashland \&\& chmod 600 \$HOME/.hashland

	exit 1
fi

. $HOME/.hashland

# generate a /etc/ethers compatible file which can be used for dhcp servers to do static assignments based on mac address
ethers()
{
	get "miners" | jq -r '.data.miners[] | select(.mac != "") | select(.mac != null) | .mac + " " + .ip'
}

get()
{
	ROUTE=$1
	PARAMS=$2

	if [ ! -z "$PARAMS" ]; then
		ROUTE=$ROUTE\?$PARAMS
	fi

	curl -s -H "Authorization: Bearer $API_KEY" ${API_URL}/${ROUTE}
}

miners()
{
	get "miners" $1 | jq .data.miners[] 
}

sensors()
{
	get "sensors" $1 | jq .data.sensors[] 
}

temp() 
{
	sensors type=DH18S20 | jq -r '.name + ": " + .value' | sort
}

miner_types()
{
	get "miner-types" $1 | jq .data.miner_types[]
}

if [ -z $1 ]; then
	echo usage: hl ethers\|miners\|miner_types\|sensors\|temp [param=value]
	echo 
	echo see https://github.com/hashland/hl-cli for examples
	echo
	exit 1
fi
	
$1 $2

