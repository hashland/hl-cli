#!/bin/sh

API_URL=https://api.hashland.cc

. $HOME/.hashland

# generate a /etc/ethers compatible file which can be used for dhcp servers to do static assignments based on mac address
ethers()
{
	get "miners" | jq -r '.data.miners[] | select(.mac != "") | select(.mac != null) | .mac + " " + .ip'
}

get()
{
	ROUTE=$1
	PARAMS=$2

	if [ ! -z "$PARAMS" ]; then
		ROUTE=$ROUTE\?$PARAMS
	fi

	curl -s -H "Authorization: Bearer $API_KEY" ${API_URL}/${ROUTE}
}

miners()
{
	get "miners" $1 | jq .data.miners[] 
}

sensors()
{
	get "sensors" $1 | jq .data.sensors[] 
}

temp() 
{
	sensors type=DH18S20 | jq -r '.name + ": " + .value' | sort
}

miner_types()
{
	get "miner-types" $1 | jq .data.miner_types[]
}

if [ -z $1 ]; then
	echo usage:
        echo $ hl ethers\|miners\|miner_types\|sensors\|temp [param=value]
	echo
	echo examples:
	echo
	echo List miners by name:
        echo $ hl miners name=XXX
	echo
	echo List miners by mac:
        echo $ hl miners mac=02:42:0d:f2:39:6a
	echo
	echo List miners by miner_type:
        echo $ hl miners miner_type=1b45a531-93e7-11e8-bd87-02420a000145
	echo
	echo List all miner types:
	echo $ hl miner_types
	echo
	echo List all sensors:
	echo $ hl sensors
	echo
	echo Get all temperature sensors:
	echo $ hl temp
	exit 1
fi
	
$1 $2

